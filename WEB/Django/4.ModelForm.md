# Django Form

- HTML에 form, input 태그가 있듯 Django 서버에서 요청(데이터)에 대한 유효성 검증이 반드시 필요.
- Django Form은 이 과정을 효율적으로 만들어 줌.
- 반복을 줄여 유효성 검사를 단순화하고 자동화 할 수 있는 기능을 제공한다.
- 역할
    1. 렌더링을 위한 데이터 준비 및 재구성
    2. 데이터에 대한 HTML forms 생성
    3. 클라이언트부터 받은 데이터 수신 및 처리

## Django Form Class
- Model과 마찬가지로 상속을 통해 선언(forms lib의 Form 클래스를 상속받음)

### 실습
1. app 폴더에 `form.py` 생성 후 ArticleForm Class 선언
2. view 업데이트
3. create 템플릿 업데이트

* 실행 화면  
![Form Class](https://user-images.githubusercontent.com/94775103/231073227-76e28578-881e-47df-b333-832bab3f5d3d.JPG)  


### From rendering options
- \<label> & <input\> 쌍에 대한 출력 옵션
1. as_p()
    - 각 필드가 단락(\<p\> 태그) 으로 감싸져서 렌더링
2. as_ul()
    - 각 필드가 목록 항목(\<li\> 태그) 로 감싸져서 렌더링
    - \<ul\> 태그는 직접 작성 必!
3. as_table()
    - 각 필드가 테이블(\<tr> 태그) 행으로 감싸져서 렌더링
* 일반적으로 as_p() 만을 사용한다.


### HTML input 요소 표현
1. Form fields
    - 입력에 대한 유효성 검사 로직 처리
    - 템플릿에서 직접 사용됨
2. Widgets
    - 웹 페이지의 HTML input 요소 렌더링을 담당, 단순히 보여지는 부분 변경
    - Widgets은 반드시 form fields에 할당됨


## Django ModelForm Class
- forms 라이브러리에서 파생된 ModelForm 클래스를 상속받음
- 정의한 ModelForm 클래스 안에 Meta 클래스를 선언
- 어떤 모델 기반으로 form을 작성할 것인지에 대한 정보를 Meta Class에 지정  <br>

```py
# articles/forms.py
from django import forms
from .models import Article

# Create your forms here.
class ArticleForm(forms.ModelForm):

    class Meta:
        model = Article
        fields = '__all__'
        # exclude = ('title', )

```  

* Meta Class
    - ModelFrom 정보 작성
    - 참조할 모델을 정하고 field 정보를 Form 에 적용
    - 원하는 필드를 포함할 수도 포함하지 않을 수도 있음(e.g. - exclude)

### view functions
* "is_valid()" method
    - 유효성 검사 실행, boolean 으로 반환
* "save()" method
    - form 인스턴스에 바인딩 된 데이터를 통해 데이터베이스 객체를 만들고 저장
    - ModelForm의 하위 클래스는 키워드 인자 instance 여부를 통해 생성할 지(create), 수정할 지(update)를 결정  

    ```py
    form = ArticleForm(request.POST, instance=article)
    form.save()
    ```  


### 실습
1. view.py 에서 create, update 함수 정리하기
2. create & update .html 수정하기

* 실행화면  
![ModelForm](https://user-images.githubusercontent.com/94775103/231077863-73fabb02-eed4-4194-a37a-120930297fad.JPG)  



### Static File  
- 응답 시 별도 처리 없이 파일 내용 그대로 보여주면 되는 파일
- **파일 자체가 고정**되어 있고 변경되지 않음
- **staticfiles** 앱을 통해 정적 파일과 관련된 기능을 제공


* 웹 서버와 정적 파일
    - 사진 파일을 얻기 위한 경로인 웹 주소(URL)가 존재하는 것
    - 즉, 웹 서버는 요청 받은 URL로 서버에 존재하는 정적 자원을 제공

#### static file 가져오기
* 들어가기 전에,
1. INSTALLED_APPS 에 django.contrib.staticsfiles 포함 여부 확인
2. settings.py에서 **STATIC_URL** 정의
3. 앱의 static 폴더에 파일 위치
    - (projectname)/static/(img_name)
4. 템플릿에서 static 템플릿 태그 사용

* 두 가지 방법
1. 기본 경로에 있는 static file 가져오기
    1. articles/static/articles/(imgfile) 경로에 파일 배치
    2. `static tag` 를 사용해 이미지 파일 출력
2. 추가 경로에 있는 static file 가져오기
    1. `settings.py` 에 추가 경로 작성
    ```py
    STATICFILES_DIRS = [
        BASE_DIR / 'static',
    ]
    ```
    2. 같은 방법으로 파일 출력 확인  



### Media File
- 사용자가 웹에서 업로드하는 정적 파일
- 유저가 업로드한 모든 정적 파일

#### ImageField()
- 이미지 업로드에 사용하는 모델 필드
- FileField를 상속받는 서브 클래스
- 사용자에 의해 업로드된 객체가 유효한지 검사

* 사용하기
1. `setting.py` 에 MEDIA_ROOT, MEDIA_URL 설정
```py
MEDIA_ROOT = '/media/'
MEDIA_ROOT = BASE_DIR / 'media'
```  
2. **upload_to** 속성을 정의하여 업로드된 파일에 사용할 MEDIA_ROOT 하위 경로 지정  
```py
# (pjt)/urls.py - 추가되는 부분
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path('admin/', admin.site.urls),
    path('articles/', include('articles.urls'))
] + static(settings.MEDIA_URL, documnet_root=settings.MEDIA_ROOT)
```

#### CREATE - ImageField 작성
* option
    1. blank
        - default: False
        - True인 경우 필드를 비워둘 수 있다.(DB에 빈 문자열 저장)
        - 유효성 검사에 사용됨(is_valid)
    2. null
        - default: False
        - True인 경우 빈 값을 DB에 NULL로 저장
        * **문자열 기반 필드에서는 이 옵션 사용을 피해야 한다.**
        (빈 문자열 과 NULL 서로 다른 표현)  

* Migrations
    - ImageField 를 사용하려면 `Pillow 라이브러리` 필요

* 추가사항
    - `form 태그` 에 enctype 속성 변경; `enctype="multipart/form-data"`
    - `articles/views.py` 에서 `request.FILES` 추가

* 실행 화면  
    - 빈 이미지는 빈 문자열로 저장, 첨부된 이미지는 MEDIA_ROOT 경로에 업로드 됨
![imagefield](https://user-images.githubusercontent.com/94775103/231089854-2a1499ab-a12f-40f5-ae46-d5b7f360abe4.JPG)  


#### READ - 업로드 이미지 출력
``` html
<!-- url 속성 이용 -->

<img src="{{ articles.image.url }}">

<!-- 만약 이미지 파일이 없을 경우 -->
{% if article.image %}
    <img src="{{ article.image.url }}" alt="">
{% endif %}
```  

#### UPDATE - 업로드 이미지 수정
* CREATE 의 `추가사항`과 동일하게 수정한다.